<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="mapscanner">
<title>mapscanner • mapscanner</title>
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://docs.ropensci.org/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="mapscanner">
<meta property="og:description" content="mapscanner">
<meta property="og:image" content="https://docs.ropensci.org/mapscanner/logo.png">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Matomo --><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
<!-- End Matomo Code -->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">mapscanner</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.0.6.005</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">Home</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/index.html">Vignettes</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Functions</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ropensci/mapscanner">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>mapscanner</h1>
                        <h4 data-toc-skip class="author">Mark Padgham and Michael D. Sumner</h4>
            
            <h4 data-toc-skip class="date">2024-03-07</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/mapscanner/blob/HEAD/vignettes/mapscanner.Rmd" class="external-link"><code>vignettes/mapscanner.Rmd</code></a></small>
      <div class="d-none name"><code>mapscanner.Rmd</code></div>
    </div>

    
    
<!--
A NOTE regarding the size of this vignette, for which it was difficult to
produce a sufficiently small sized end result, largely because of the mapshot
images. The above values can be passed to mapshot to reduce those. The
following table shows sizes of resultant installed versions following various
options:

ggplot | mapshot } inst size | vignettes size
---  | --- | --- | ---
 -   |  -  | 2.2MB | 1.2MB
 yes |  -  | 2.4MB | 1.5MB
 yes |  1  | 2.9MB | 2.0MB (original mapshot image only)
 yes |  3  | 3.4MB | 2.5MB

 At present, the vignette is rendered as in the final row, but can potentially
 be reduced in size in the future according to this table. -->
<div class="section level2">
<h2 id="what-does-this-package-do-for-me">What does this package do for me?<a class="anchor" aria-label="anchor" href="#what-does-this-package-do-for-me"></a>
</h2>
<p><code>mapscanner</code> is an <strong>R</strong> package that enables lines drawn by hand on maps to be converted to spatial objects. The package has two primary functions: one for producing maps, and one for rectifying hand-drawn lines to the coordinate system of the original map. The package is intended for use in social surveys and similar endeavours in which hand-drawn markings on maps need to be converted to spatial objects. Maps can be either paper- or screen-based. Markings on paper maps need to be scanned, photographed, or otherwise digitised, while maps with screen-based markings need to be saved as <code>.png</code>- or <code>.pdf</code>-format images.</p>
</div>
<div class="section level2">
<h2 id="how-do-i-use-it">How do I use it?<a class="anchor" aria-label="anchor" href="#how-do-i-use-it"></a>
</h2>
<p>The package is designed to enable the following workflow:</p>
<ol style="list-style-type: decimal">
<li><p>Generate a map with the <a href="https://docs.ropensci.org/mapscanner/reference/ms_generate_map.html"><code>ms_generate_map()</code></a> function, which automatically produces both <code>.pdf</code> and <code>.png</code> versions;</p></li>
<li><p>Either print the <code>.pdf</code> version to use as desired in any kind of survey environment, or use either the <code>.pdf</code> or <code>.png</code> versions in digital form for screen-based surveys.</p></li>
<li><p>Draw on the map;</p></li>
<li><p>For paper maps, digitise the drawn-on (from here on, “modified”) map, converting it to either <code>.pdf</code> or <code>.png</code> format; and</p></li>
<li><p>Rectify the modified version against the original via the <a href="https://docs.ropensci.org/mapscanner/reference/ms_rectify_map.html"><code>ms_rectify_map()</code></a> function, which distinguishes individual annotations, and converts each one to a spatial object able to be analysed in any desired manner.</p></li>
</ol>
<div class="section level3">
<h3 id="practical-tips">Practical tips<a class="anchor" aria-label="anchor" href="#practical-tips"></a>
</h3>
<p>The <code>mapscanner</code> package is intended to aid a <em>practical</em> workflow, and so a few practical tips may be recommended here to ensure best results:</p>
<ol style="list-style-type: decimal">
<li>The original digital files generated with <a href="https://docs.ropensci.org/mapscanner/reference/ms_generate_map.html"><code>ms_generate_map()</code></a> are necessary to rectify subsequently drawn-on and scanned maps, and so must be retained at all times.</li>
<li>Marks drawn on maps should be <em>coloured</em> – any black or grey markings will be ignored. This has the advantage that individual annotations <em>not</em> intended to be converted to spatial objects (such as unique identification or participant codes) may be made on maps in black or grey.</li>
<li>For drawings of areas, best results will be achieved through ensuring that all lines form closed polygons. While the default <code>type = "hulls"</code> argument should work even when lines are not closed, the <code>type = "polygons"</code> argument will generally produce more accurate results, yet should only be used when all lines form closed polygons (see below for details on how these two differ).</li>
<li>Digitised versions of paper maps should contain <em>white</em> borders, so do not, for example, photograph modified maps lying on dark surfaces. If maps are to be photographed, then best results can be achieved by simply placing them on a larger, enclosing sheet of white paper.</li>
</ol>
<p>The following two sections describe the two primary functions of the <code>mapscanner</code> package, corresponding to the two primary steps of producing maps to be used in surveys (or other activities), and rectifying modified maps against these originals in order to extract spatial objects. The second of these sections also describes the kinds of markings able to be recognised, and the kinds of spatial objects to which these may be converted.</p>
</div>
</div>
<div class="section level2">
<h2 id="mapbox-api-tokens">Mapbox API tokens<a class="anchor" aria-label="anchor" href="#mapbox-api-tokens"></a>
</h2>
<p>Map generation with <code>mapscanner</code> requires a personal token or key from <a href="https://www.mapbox.com/" class="external-link"><code>mapbox</code></a>, which can be obtained by following the links from <a href="https://docs.mapbox.com/api/#access-tokens-and-token-scopes/" class="external-link">https://docs.mapbox.com/api/</a>. If you already have a token, the easiest way to use it with <code>mapscanner</code> is to create (or edit) a file <code>~/.Renviron</code>, and insert a line,</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="va">MAPBOX_TOKEN</span><span class="op">=&lt;</span>my_mapbox_token<span class="op">&gt;</span></span></code></pre></div>
<p>This will then be available every time you start R, without any need to explicitly set the token each time you want to use the package. The token may be given any unique name that includes “mapbox” (case insensitive). Alternatively, if you wish to keep your token truly private, and only use it for your current R session, you may load <code>mapscanner</code>, and then run <code>set_mapbox_token(&lt;my_mapbox_token&gt;)</code>.</p>
</div>
<div class="section level2">
<h2 id="map-generation">Map generation<a class="anchor" aria-label="anchor" href="#map-generation"></a>
</h2>
<p>Having obtained and set a <a href="https://www.mapbox.com/" class="external-link"><code>mapbox</code></a> token as described above, the <a href="https://docs.ropensci.org/mapscanner/reference/ms_generate_map.html"><code>ms_generate_map()</code></a> function can be used to generate printable maps for a specified bounding box in both <code>.pdf</code> and <code>.png</code> formats. Usage is a simple as,</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ms_generate_map.html">ms_generate_map</a></span> <span class="op">(</span><span class="st">"chennai india"</span>, mapname <span class="op">=</span> <span class="st">"chennai"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Successfully generated 'chennai.pdf' and 'chennai.png'</span></span></code></pre>
<p>The two generated maps are saved in the current working directory (<code><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd()</a></code>). To save maps in alternative locations, the <code>mapname</code> parameter can optionally specify paths. To provide finer control over the scales of maps, precise bounding boxes can also be submitted. To determine desired bounding boxes, we recommend using the <a href="https://www.openstreetmap.org/" class="external-link">‘openstreetmap.org’ website</a>, zooming to a desired area, then clicking the “Export” button. A window will appear which includes the bounding coordinates of the current screen. Even finer control can be gained by clicking beneath this coordinate window on the line which says, “Manually select a different area,” which brings a drag-able rectangle onto the current screen. The coordinates in the bounding box then simply need to be entered in to the <code>bbox</code> parameter of <a href="https://docs.ropensci.org/mapscanner/reference/ms_generate_map.html"><code>ms_generate_map()</code></a> in the order (<code>xmin</code>, <code>ymin</code>, <code>xmax</code>, <code>ymax</code>) – or anti-clockwise from the left-hand coordinate.</p>
<p>The amount of detail in resultant maps is controlled by the <code>max_tiles</code> argument, with larger values producing more detail, and resulting in larger file sizes. The default value of <code>max_tiles = 16L</code> (where the <code>L</code> symbol tells <code>R</code>to treat the value as an integer) should produce acceptable results for maps extending across hundreds of metres to a few kilometres. Smaller-scale maps may require higher values, and vice-versa. Map generation is relatively fast, and so different values can be readily trialled.</p>
<p>Maps are generated in two formats, because the <code>.pdf</code> version will generally be the most convenient for printing, while the <code>png</code> version should be retained as the “master” copy against which to rectify subsequently scanned-in version. Behind the scenes, the function downloads a series of vector map tiles from <a href="https://www.mapbox.com/" class="external-link">mapbox</a>, and converts them to a <code>rasterBrick</code> object from the <a href="https://cran.r-project.org/package=raster" class="external-link"><code>raster</code> package</a>. This <code>rasterBrick</code> object is invisibly returned from the function:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ms_generate_map.html">ms_generate_map</a></span> <span class="op">(</span><span class="st">"chennai india"</span>, mapname <span class="op">=</span> <span class="st">"chennai"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Successfully generated 'chennai.pdf' and 'chennai.png'</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span></span></code></pre></div>
<pre><code><span><span class="co">## class      : RasterBrick</span></span>
<span><span class="co">## dimensions : 1147, 562, 644614, 3  (nrow, ncol, ncell, nlayers)</span></span>
<span><span class="co">## resolution : 38.21851, 38.21851  (x, y)</span></span>
<span><span class="co">## extent     : 8921157, 8942635, 1442787, 1486624  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">## crs        : +proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs</span></span>
<span><span class="co">## source     : memory</span></span>
<span><span class="co">## names      : index_1.1, index_1.2, index_1.3</span></span>
<span><span class="co">## min values :       107,       107,       107</span></span>
<span><span class="co">## max values :       254,       254,       254</span></span></code></pre>
<p>This <code>rasterBrick</code> object contains raster information for the three colour channels of the image, and so may also be used for immediate viewing within <strong>R</strong> with <code>raster::plotRGB(x)</code>.</p>
<p>Standard uses of the package should not need to explicitly access or modify these data, but it is nevertheless possible to do so, and then use a custom-modified object to produce the external <code>.pdf</code> and <code>.png</code> files by submitting the <code>rasterBrick</code> object to <a href="https://docs.ropensci.org/mapscanner/reference/ms_generate_map.html"><code>ms_generate_map()</code></a>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ms_generate_map.html">ms_generate_map</a></span> <span class="op">(</span>raster_brick <span class="op">=</span> <span class="va">x</span>, mapname <span class="op">=</span> <span class="st">"chennai"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="map-rectification">Map rectification<a class="anchor" aria-label="anchor" href="#map-rectification"></a>
</h2>
<p>Having produced digital maps using the <a href="https://docs.ropensci.org/mapscanner/reference/ms_generate_map.html"><code>ms_generate_map()</code></a> function as described above, and having printed, variously drawn-on, and, for paper maps, scanned the result back in to digital form, the package can then be used to rectify the hand-drawn markings against the original map with the <a href="https://docs.ropensci.org/mapscanner/reference/ms_rectify_map.html"><code>ms_rectify_map()</code></a> function, which returns the drawn-on objects as spatial objects in <a href="https://cran.r-project.org/package=sf" class="external-link">Simple Features (<code>sf</code>)</a> format. The only requirement is that the drawn-on objects are coloured; black or grey objects will be ignored. As described above, this has the advantage that maps may be annotated in ways not intended to be converted to spatial objects (such as adding unique identification or participant codes), through simply providing such annotations in grey or black.</p>
<p>The <a href="https://docs.ropensci.org/mapscanner/reference/ms_rectify_map.html"><code>ms_rectify_map()</code></a> function has two primary arguments, specifying the names (and locations) of the original and modified map files – in that order: <code>ms_rectify_map(original, modified)</code>. These files should ideally be in <code>.png</code> formats, but will be auto-converted from <code>.pdf</code> if needed. The package comes with two sample maps, both in <code>.png</code> format. The first is the reference version needed for rectification, while the second has two red lines drawn upon it:</p>
<!--
<img src="omaha-polygons.png" width="600" height="400"/>
-->
<p><img src="../../../RtmpgjPwK1/omama-polygons.png" width="75%"></p>
<p>Converting the lines on this scanned image file is then as simple as:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f_orig</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span> <span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"omaha.png"</span>, package <span class="op">=</span> <span class="st">"mapscanner"</span><span class="op">)</span></span>
<span><span class="va">f_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span> <span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"omaha-polygons.png"</span>, package <span class="op">=</span> <span class="st">"mapscanner"</span><span class="op">)</span></span>
<span><span class="va">xy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ms_rectify_map.html">ms_rectify_map</a></span> <span class="op">(</span><span class="va">f_orig</span>, <span class="va">f_mod</span>, nitems <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">xy</span></span></code></pre></div>
<pre><code><span><span class="co">## Simple feature collection with 2 features and 0 fields</span></span>
<span><span class="co">## Geometry type: POLYGON</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: -96.11801 ymin: 41.26638 xmax: -96.02722 ymax: 41.30108</span></span>
<span><span class="co">## Geodetic CRS:  WGS 84</span></span>
<span><span class="co">##                         geometry</span></span>
<span><span class="co">## 1 POLYGON ((-96.10692 41.2684...</span></span>
<span><span class="co">## 2 POLYGON ((-96.0276 41.2964,...</span></span></code></pre>
<p>The result of <a href="https://docs.ropensci.org/mapscanner/reference/ms_rectify_map.html"><code>ms_rectify_map()</code></a> can be plotted using any standard option for plotting spatial data, such as through online mapping packages such as <code>mapview</code>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xy</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span> <span class="op">(</span><span class="va">xy</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">mapview</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/mapview/reference/mapView.html" class="external-link">mapview</a></span> <span class="op">(</span><span class="va">xy</span><span class="op">)</span></span></code></pre></div>
<!--
![](mapshot-polys.png)
-->
<p><img src="mapshot-hulls.png" width="75%"></p>
<div class="section level3">
<h3 id="types-of-map-markings-and-types-of-spatial-objects">Types of map markings and types of spatial objects<a class="anchor" aria-label="anchor" href="#types-of-map-markings-and-types-of-spatial-objects"></a>
</h3>
<p>The <a href="https://docs.ropensci.org/mapscanner/reference/ms_rectify_map.html"><code>ms_rectify_map()</code></a> function has an additional argument, <code>type</code>, which takes the following values:</p>
<ol style="list-style-type: decimal">
<li>
<code>type = "hulls"</code> (the default), which returns convex or concave hulls around distinct sets of contiguously marked lines, regardless of whether those lines form closed polygons or not (see function help for details).</li>
<li>
<code>type = "polygons"</code>, which returns the outlines traced around each individual drawn object. This tracing is pixel-based, resulting in polygons with one spatial point for each scanned pixel. This may generate spatial objects that are both overly large as well as visually pixillated. The function includes an additional <code>downsample</code> parameter which down-samples and smooths the resultant polygons by the specified multiple.</li>
<li>
<code>type = "points"</code>, which returns single points (as geometric centroids) for each object. This is useful for identification of individual point locations regardless of the kinds of marks actually drawn on a map (dots, circles, crosses, or any shape, should all give equivalent results).</li>
</ol>
<p>The type of <code>polygons</code> assumes – and indeed requires – that the drawn objects are <em>closed</em> polygons (as illustrated in the first of the above figures), so care must be taken to ensure this is in fact the case. Any lines that do not form closed circles will not be appropriately translated. Algorithms for extracting objects with <code>type = "polygons"</code>are fundamentally different from <code>type = "hulls"</code>. The latter applies convex or concave-hull tracing algorithms, while the former explicitly traces every individual pixel of a contiguous object, and returns the external boundary comprised of the coordinates of all pixels lying on that boundary. This will thus often produce more accurate and detailed results, yet as mentioned should only be applied where markings form strictly closed polygons. All other cases in which areal rather than point-based results are desired should use the default <code>type = "hulls"</code>. Examples include participants being asked to colour particular areas using any desired kind of marks, enabling areal-filling scribbles can be converted to polygons representing the outer boundaries.</p>
<p>The <code>"polygon"</code> and <code>"point"</code> types are illustrated in the following maps:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f_orig</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span> <span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"omaha.png"</span>, package <span class="op">=</span> <span class="st">"mapscanner"</span><span class="op">)</span></span>
<span><span class="va">f_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span> <span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"omaha-polygons.png"</span>, package <span class="op">=</span> <span class="st">"mapscanner"</span><span class="op">)</span></span>
<span><span class="va">xy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ms_rectify_map.html">ms_rectify_map</a></span> <span class="op">(</span><span class="va">f_orig</span>, <span class="va">f_mod</span>, type <span class="op">=</span> <span class="st">"polygons"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xy</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span> <span class="op">(</span><span class="va">xy</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">mapview</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/mapview/reference/mapView.html" class="external-link">mapview</a></span> <span class="op">(</span><span class="va">xy</span><span class="op">)</span></span></code></pre></div>
<!--
![](mapshot-polys.png)
-->
<p><img src="mapshot-polys.png" width="75%"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f_orig</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span> <span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"omaha.png"</span>, package <span class="op">=</span> <span class="st">"mapscanner"</span><span class="op">)</span></span>
<span><span class="va">f_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span> <span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"omaha-polygons.png"</span>, package <span class="op">=</span> <span class="st">"mapscanner"</span><span class="op">)</span></span>
<span><span class="va">xy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ms_rectify_map.html">ms_rectify_map</a></span> <span class="op">(</span><span class="va">f_orig</span>, <span class="va">f_mod</span>, type <span class="op">=</span> <span class="st">"points"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xy</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span> <span class="op">(</span><span class="va">xy</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">mapview</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/mapview/reference/mapView.html" class="external-link">mapview</a></span> <span class="op">(</span><span class="va">xy</span><span class="op">)</span></span></code></pre></div>
<!--
![](mapshot-points.png)
-->
<p><img src="mapshot-points.png" width="75%"></p>
</div>
</div>
<div class="section level2">
<h2 id="bonus-feature-polygon-aggregation">Bonus Feature: Polygon Aggregation<a class="anchor" aria-label="anchor" href="#bonus-feature-polygon-aggregation"></a>
</h2>
<p>Maps are typically used in social surveys to delineate participants’ understanding or perception of particular regions or areas. In such contexts, surveys often result in numerous polygonal shapes representing different perceptions of a particular region. The <code>mapscanner</code> package provides an additional function, <code><a href="../reference/ms_aggregate_polys.html">ms_aggregate_polys()</a></code>, to aggregate polygons into a single “heat map” containing vector outlines of aggregated polygons. Each component of these aggregated polygons defines the region within which <code>n</code> polygons overlap.</p>
<p>The function is now illustrated with a slightly more complicated version of the example provided for <code><a href="../reference/ms_aggregate_polys.html">ms_aggregate_polys()</a></code>, starting by generating a series of polygons as convex hulls surrounding random points.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">5</span> <span class="co"># number of polygons</span></span>
<span><span class="va">polys</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span> <span class="op">(</span><span class="va">n</span><span class="op">)</span>, <span class="kw">function</span> <span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>                     <span class="va">nxy</span> <span class="op">&lt;-</span> <span class="fl">20</span> <span class="co"># number of points used to generate hull</span></span>
<span>                     <span class="va">xy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">nxy</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>                     <span class="va">h</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/chull.html" class="external-link">chull</a></span> <span class="op">(</span><span class="va">xy</span><span class="op">)</span></span>
<span>                     <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_polygon</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span> <span class="op">(</span><span class="va">xy</span> <span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="va">h</span>, <span class="va">h</span> <span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="op">}</span><span class="op">)</span></span>
<span><span class="va">polys</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">st_sf</a></span> <span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span> <span class="op">(</span><span class="va">n</span><span class="op">)</span>, geometry <span class="op">=</span> <span class="va">polys</span><span class="op">)</span></span></code></pre></div>
<p>The <code>polys</code> object is then a Simple Features (<a href="https://cran.r-project.org/package=sf" class="external-link"><code>sf</code></a>) <code>data.frame</code> with <code>n</code> overlapping polygons, and an additional row, <code>n</code>, to identify each polygon. The following lines then convert these to aggregated, overlapping polygons, and plot the result:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aggr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ms_aggregate_polys.html">ms_aggregate_polys</a></span> <span class="op">(</span><span class="va">polys</span><span class="op">)</span></span>
<span><span class="va">polys</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"raw polygons"</span></span>
<span><span class="va">aggr</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"aggregated polygons"</span></span>
<span><span class="va">polys</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span> <span class="op">(</span><span class="va">polys</span>, <span class="va">aggr</span><span class="op">)</span></span>
<span><span class="co"># Convert type to factor to order facets:</span></span>
<span><span class="va">polys</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span> <span class="op">(</span><span class="va">polys</span><span class="op">$</span><span class="va">type</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="st">"raw polygons"</span>, <span class="st">"aggregated polygons"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span> <span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span> <span class="op">(</span><span class="va">polys</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span> <span class="op">(</span>fill <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span> <span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span> <span class="op">(</span><span class="op">~</span><span class="va">type</span><span class="op">)</span></span></code></pre></div>
<p><img src="mapscanner_files/figure-html/random-polys-1.png" width="700"></p>
<p>The left panel of that figure shows the random polygons in raw form successively overlaid upon one another. The right panel shows the aggregated contours of successive overlap from 1 to 5. The object returned from <a href="https://docs.ropensci.org/mapscanner/reference/ms_aggregate_polys.html"><code>ms_aggregate_polys()</code></a> contains polygons ordered by level of aggregation (<code>n</code>), so the first entirely encloses the second; the second encloses the third; and so on. Particular contours can then be directly selected by filtering for desired values of <code>n</code>:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span> <span class="op">(</span><span class="va">aggr</span> <span class="op">[</span><span class="va">aggr</span><span class="op">$</span><span class="va">n</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span>, <span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span> <span class="op">(</span>fill <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span> <span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="mapscanner_files/figure-html/aggr13-1.png" width="700"></p>
<p>Polygon aggregation enables many interesting analyses to be performed, such as relationships between aggregation level and area:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aggr</span><span class="op">$</span><span class="va">area</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_area</a></span> <span class="op">(</span><span class="va">aggr</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span> <span class="op">(</span><span class="va">aggr</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span> <span class="op">(</span>x <span class="op">=</span> <span class="va">n</span>, y <span class="op">=</span> <span class="va">area</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span> <span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Please use `linewidth` instead.</span></span>
<span><span class="co">## <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">## <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">## <span style="color: #555555;">generated.</span></span></span></code></pre>
<p><img src="mapscanner_files/figure-html/aggr-area-1.png" width="700"></p>
<p>That result is of course (roughly) linear, because it was derived from random data. In actual usage, results such as that are likely to generate direct insight into consensus of opinion regarding how people understand particular areas.</p>
</div>
<div class="section level2">
<h2 id="how-it-works">How it works<a class="anchor" aria-label="anchor" href="#how-it-works"></a>
</h2>
<p>(This section is not necessary for package usage, and merely provides detail for those interested in how the process actually works.) <code>mapscanner</code> primarily relies on the <a href="https://github.com/jonclayden/RNiftyReg" class="external-link"><code>RNiftyReg</code> package</a> to rectify the images. This package is itself primarily aimed at rectifying medical scans, but also happens to be the perfect tool for the present purposes. Being an image analysis software, the library requires image objects, and not <code>pdf</code> files, which is why the <a href="https://docs.ropensci.org/mapscanner/reference/ms_generate_map.html"><code>ms_generate_map()</code></a> function produces both kinds of files - the <code>.pdf</code> for printing and the <code>.png</code> for rectifying with the <code>RNiftyReg</code> package.</p>
<p>Rectification re-projects a scanned image back on to the coordinate system of an original image. This coordinate system translates here in to a defined bounding box (which may differ slightly from the values input into the function, due to the cutting and stitching of the vector tiles). This bounding box is embedded as meta-information in both the files produced by <a href="https://docs.ropensci.org/mapscanner/reference/ms_generate_map.html"><code>ms_generate_map()</code></a>; in the <code>.pdf</code> as standard meta information accessible in <strong>R</strong> like this:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pdftools</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/pdftools/reference/pdftools.html" class="external-link">pdf_info</a></span> <span class="op">(</span><span class="st">"chennai.pdf"</span><span class="op">)</span><span class="op">$</span><span class="va">keys</span></span></code></pre></div>
<pre><code><span><span class="co">## $Title</span></span>
<span><span class="co">## [1] "EX8921118.44521949+1442748.9088827+8942673.68719591+1486623.76311839"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Producer</span></span>
<span><span class="co">## [1] "R 4.0.0"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Creator</span></span>
<span><span class="co">## [1] "R"</span></span></code></pre>
<p>or in a terminal via <code>pdfinfo</code> (or non-linux equivalent), and embedded in the <code>.png</code> file as comment, accessible like this:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">img</span> <span class="op">&lt;-</span> <span class="fu">magick</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/magick/reference/editing.html" class="external-link">image_read</a></span> <span class="op">(</span><span class="st">"chennai.png"</span><span class="op">)</span></span>
<span><span class="fu">magick</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/magick/reference/attributes.html" class="external-link">image_comment</a></span> <span class="op">(</span><span class="va">img</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "EX8921118.44521949+1442748.9088827+8942673.68719591+1486623.76311839"</span></span></code></pre>
<p>or in a terminal via <code>identify -verbose</code> command (itself part of the <code>imagemagick</code> library which drives the <a href="https://github.com/ropensci/magick" class="external-link"><code>magick</code> <strong>R</strong> package</a>).</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer>
</div>

  

  

  </body>
</html>
